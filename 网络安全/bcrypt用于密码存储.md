## 密码的存储
在需要用户模块的项目中，对于用户密码的保存，一般不会使用明文保存，这样是不安全的。通常情况下，我们都需要对密码进行不可逆的加密，然后存放在数据库中。然后在用户登录的时候，把其输入的密码进行加密与数据库中存放的密文对比来判断密码是否正确。

### MD5的缺点
MD5很常用，但是虽然无法可以直接获取明文，但可以通过穷举，列表查询方式获取明文，md5的查询库是非常丰富的。

比较常见的**彩虹表**就可以用于破解常规md5密码

#### 彩虹表
攻击者可以将所有密码的常见组合进行单向哈希，得到一个摘要组合, 然后与数据库中的摘要进行比对即可获得对应的密码。这个摘要组合也被称为rainbow table。

**彩虹表就是一个庞大的、针对各种可能的字母组合预先计算好的哈希值的集合**，不一定是针对MD5算法的，各种算法的都有，有了它可以快速的破解各类密码。越是复杂的密码，需要的彩虹表就越大，现在主流的彩虹表都是100G以上，目前主要的算法有LM, NTLM, MD5, SHA1, MYSQLSHA1, HALFLMCHALL, NTLMCHALL, ORACLE-SYSTEM, MD5-HALF。

利用彩虹表，可以比较轻松的破解常规的md5加密的方式。

### 现在的方案
直接用MD5加密并保存到数据库中的方法已然是不够安全的了，那么我们该怎么做呢。


第一种做法是，采用MD5+加盐的方式。

现在很多加密方法计算密码Hash时，**会在待处理的明文字符串后面加上一串随机的字符串再进行加密操作**，开始密码验证时会先在用户输入的密码后加上相同的随机字串进行加密，结果再与存储的Hash进行比较。如明文口令是qshud，则附加上一段随机字符串再计算hash，正确口令的hash存储时也是这样的处理过程，这样做的一个好处就是可以在一定程度上防止彩虹表破译，假设随机字符串为“！@#￥”之类的特殊符号，在造表的过程中设计R函数就需要考虑到映射回这些特殊符号，这就大大增大了造表的空间和难度。

因为彩虹表是针对可能而预先计算好的表，随机字串增多会导致彩虹表要重新构造，加大了负担，因此更加安全。

不过时至今日，**计算机运算量的加大，md5加盐的方式还是显得不够安全。**

**因此，我们采用安全程度更高的hash算法来解决是现在更好的方案。**

因为机器运算暴力破解的速度已经越来越快了，我们只能通过增大hash算法的计算时间来增加破解难度。

比如现在最常用的**Bcrypt**算法，在hash计算的过程中加入迭代次数作为参数，使得hash算法的复杂程度提高了几个数量级。这会大大增加破解的难度，因为需要更长的时间构造表，消费更大。最终要的是，随着计算能力越来越高，这个**work factor迭代参数**可以随着计算能力进行调整，有非常高的可扩展性。

**所以现在更建议用bcrypt算法，来进行密码存储。**